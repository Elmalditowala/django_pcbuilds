{% extends 'core/base_generic.html' %}

{% block title %}Carrito de Compras - PC Builds{% endblock %}

{% block content %}
<div class="container">
  <div class="row">

      <div class="col-sm-8">
          <div class="product-details mr-2">
              <h2>Carrito de compras</h2>
                <hr>
              <h6 class="mb-0">
                Mi Carrito
              </h6>
              <div class="d-flex justify-content-between">
                  <p></p>
              </div>
          </div>
      </div>

      <div class="col-sm-4">
          <div class="payment-info">
              <div class="d-flex justify-content-between align-items-center">
                <span><h5>Formas de Pago</h5></span>
                <img class="rounded" src="{% static 'core/Imagenes/Logos-img/logoprincipal.png' %}" width="30">
              </div>

              <label class="radio"> 
                <input type="radio" name="card" value="payment" checked>
                <span><img width="30" src="{% static 'core/Imagenes/Logos-img/Pagos/pay-visa.png' %}"/></span> 
              </label>

              <label class="radio"> 
                <input type="radio" name="card" value="payment"> 
                <span><img width="30" src="{% static 'core/Imagenes/Logos-img/Pagos/pay-master.png' %}"/></span> 
              </label>

              <label class="radio"> 
                <input type="radio" name="card" value="payment"> 
                <span><img width="30" src="{% static 'core/Imagenes/Logos-img/Pagos/pay-khipu.png' %}"/></span> 
              </label>

              <label class="radio"> 
                <input type="radio" name="card" value="payment"> 
                <span><img width="30" src="{% static 'core/Imagenes/Logos-img/Pagos/pay-webpay.png' %}"/></span> 
              </label>
              
              <div>
                <label class="credit-card-label">Nombre Titular Tarjeta</label>
                <input type="text" class="form-control credit-inputs" placeholder="Nombre" id="nombre" required pattern="[A-Za-z\s]+">
                <span class="error-message" id="nombreError" style="color:red;"></span>
              </div>

              <div>
                <label class="credit-card-label">Numero de Tarjeta</label>
                <input type="text" class="form-control credit-inputs" placeholder="0000 0000 0000 0000" id="numeroTarjeta" required pattern="\d{4} \d{4} \d{4} \d{4}">
                <span class="error-message" id="numeroTarjetaError" style="color:red;"></span>
              </div>

              <div class="row">
                <div class="col-md-6">
                  <label class="credit-card-label">Fecha</label>
                  <input type="text" class="form-control credit-inputs" placeholder="12/24" id="fecha" required pattern="\d{2}/\d{2}">
                  <span class="error-message" id="fechaError" style="color:red;"></span>
                </div>
                <div class="col-md-6">
                  <label class="credit-card-label">CVV</label>
                  <input type="text" class="form-control credit-inputs" placeholder="342" id="cvv" required pattern="\d{3}">
                  <span class="error-message" id="cvvError" style="color:red;"></span>
                </div>
              </div>

              <hr>
              <div class="d-flex justify-content-between information"><span>Subtotal</span><span>$184.500</span></div>
              <div class="d-flex justify-content-between information"><span>Envio (Chilexpress)</span><span>$5.500</span></div>
              <div class="d-flex justify-content-between information"><span>Total</span><span>$190.990</span></div>

              <button class="btn btn-success btn-block d-flex justify-content-between mt-3" type="button" onclick="validarYRedirigir()">
                <span><center>$190.990</center></span>
                <span>Pagar
                  <i class="fa fa-long-arrow-right ml-1"></i>
                </span>
              </button>

              <script>
                function validarYRedirigir() {
                  const nombre = document.getElementById('nombre');
                  const numeroTarjeta = document.getElementById('numeroTarjeta');
                  const fecha = document.getElementById('fecha');
                  const cvv = document.getElementById('cvv');

                  const nombreError = document.getElementById('nombreError');
                  const numeroTarjetaError = document.getElementById('numeroTarjetaError');
                  const fechaError = document.getElementById('fechaError');
                  const cvvError = document.getElementById('cvvError');

                  let valid = true;

                  if (!nombre.checkValidity()) {
                    nombreError.textContent = 'El nombre solo puede contener letras y espacios.';
                    valid = false;
                  } else {
                    nombreError.textContent = '';
                  }

                  if (!numeroTarjeta.checkValidity()) {
                    numeroTarjetaError.textContent = 'El número de tarjeta debe estar en el formato 0000 0000 0000 0000.';
                    valid = false;
                  } else {
                    numeroTarjetaError.textContent = '';
                  }

                  if (!fecha.checkValidity()) {
                    fechaError.textContent = 'La fecha debe estar en el formato MM/YY.';
                    valid = false;
                  } else {
                    fechaError.textContent = '';
                  }

                  if (!cvv.checkValidity()) {
                    cvvError.textContent = 'El CVV debe ser un número de 3 dígitos.';
                    valid = false;
                  } else {
                    cvvError.textContent = '';
                  }

                  if (valid) {
                    window.location.href = "{% url 'pagoaprobado' %}";
                  }
                }
              </script>
           </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
